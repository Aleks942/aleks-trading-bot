import numpy as np
import pandas as pd


def impulse_strength(df, period=14):
    """
    Вычисляет силу импульса.
    Возвращает число от 0 до 10.
    """

    close = df.close
    returns = close.pct_change()

    # ускорение = изменение скорости роста/падения
    acceleration = returns.diff().rolling(period).mean()

    # нормализуем значение
    imp = acceleration.iloc[-1] * 1000

    # ограничиваем диапазон 0-10
    imp = max(0, min(10, abs(imp)))

    return round(imp, 2)


def impulse_signal(df, threshold=3):
    """
    Проверяет, есть ли импульс.
    threshold — минимальная сила для сигнала.
    """
    strength = impulse_strength(df)

    if strength >= threshold:
        return {
            "signal": True,
            "strength": strength
        }

    return {
        "signal": False,
        "strength": strength
    }
